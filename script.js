var text = ['TIM-1.0',
'WTMI-devel-18.12.0-a0a1cb8',
'WTMI: system early-init',
'CPU VDD voltage default value: 1.108V',
'NOTICE:  Booting Trusted Firmware',
'NOTICE:  BL1: v1.5(release):1f8ca7e (Marvell-devel-18.12.2)',
'NOTICE:  BL1: Built : 09:46:46, Feb 20 2019',
'NOTICE:  BL1: Booting BL2',
'NOTICE:  BL2: v1.5(release):1f8ca7e (Marvell-devel-18.12.2)',
'NOTICE:  BL2: Built : 09:46:47, Feb 20 2019',
'NOTICE:  BL1: Booting BL31',
'NOTICE:  BL31: v1.5(release):1f8ca7e (Marvell-devel-18.12.2)',
'NOTICE:  BL31: Built : 09:46:50',
'',
'U-Boot 2018.03-devel-18.12.3-gc9aa92c-armbian (Feb 20 2019 - 09:45:04 +0100)',
'',
'Model: Marvell Armada 3720 Community Board ESPRESSOBin',
'       CPU     800 [MHz]',
'       L2      800 [MHz]',
'       TClock  200 [MHz]',
'       DDR     800 [MHz]',
'DRAM:  1 GiB',
'Comphy chip #0:',
'Comphy-0: USB3          5 Gbps    ',
'Comphy-1: PEX0          2.5 Gbps  ',
'Comphy-2: SATA0         6 Gbps    ',
'SATA link 0 timeout.',
'AHCI 0001.0300 32 slots 1 ports 6 Gbps 0x1 impl SATA mode',
'flags: ncq led only pmp fbss pio slum part sxs ',
'PCIE-0: Link down',
'MMC:   sdhci@d0000: 0, sdhci@d8000: 1',
'Loading Environment from SPI Flash... SF: Detected w25q32dw with page size 256 Bytes, erase size 4 KiB, total 4 MiB',
'OK',
'Model: Marvell Armada 3720 Community Board ESPRESSOBin',
'Net:   eth0: neta@30000 [PRIME]',
'Hit any key to stop autoboot:  0 ',
'starting USB...',
'USB0:   Register 2000104 NbrPorts 2',
'Starting the controller',
'USB XHCI 1.00',
'USB1:   USB EHCI 1.00',
'scanning bus 0 for devices... TIM-1.0',
'WTMI-devel-18.12.0-a0a1cb8',
'WTMI: system early-init',
'CPU VDD voltage default value: 1.108V',
'NOTICE:  Booting Trusted Firmware',
'NOTICE:  BL1: v1.5(release):1f8ca7e (Marvell-devel-18.12.2)',
'NOTICE:  BL1: Built : 09:46:46, Feb 20 2019',
'NOTICE:  BL1: Booting BL2',
'NOTICE:  BL2: v1.5(release):1f8ca7e (Marvell-devel-18.12.2)',
'NOTICE:  BL2: Built : 09:46:47, Feb 20 2019',
'NOTICE:  BL1: Booting BL31',
'NOTICE:  BL31: v1.5(release):1f8ca7e (Marvell-devel-18.12.2)',
'NOTICE:  BL31: Built : 09:46:50',
'',
'U-Boot 2018.03-devel-18.12.3-gc9aa92c-armbian (Feb 20 2019 - 09:45:04 +0100)',
'',
'Model: Marvell Armada 3720 Community Board ESPRESSOBin',
'       CPU     800 [MHz]',
'       L2      800 [MHz]',
'       TClock  200 [MHz]',
'       DDR     800 [MHz]',
'DRAM:  1 GiB',
'Comphy chip #0:',
'Comphy-0: USB3          5 Gbps    ',
'Comphy-1: PEX0          2.5 Gbps  ',
'Comphy-2: SATA0         6 Gbps    ',
'SATA link 0 timeout.',
'AHCI 0001.0300 32 slots 1 ports 6 Gbps 0x1 impl SATA mode',
'flags: ncq led only pmp fbss pio slum part sxs ',
'PCIE-0: Link down',
'MMC:   sdhci@d0000: 0, sdhci@d8000: 1',
'Loading Environment from SPI Flash... SF: Detected w25q32dw with page size 256 Bytes, erase size 4 KiB, total 4 MiB',
'OK',
'Model: Marvell Armada 3720 Community Board ESPRESSOBin',
'Net:   eth0: neta@30000 [PRIME]',
'Hit any key to stop autoboot:  0 ',
'starting USB...',
'USB0:   Register 2000104 NbrPorts 2',
'Starting the controller',
'USB XHCI 1.00',
'USB1:   USB EHCI 1.00',
'scanning bus 0 for devices... 2 USB Device(s) found',
'scanning bus 1 for devices... 1 USB Device(s) found',
'       scanning usb for storage devices... 1 Storage Device(s) found',
'/',
'** Unrecognized filesystem type **',
'## Executing script at 06d00000',
'Wrong image format for "source" command',
'/boot/',
'** Unrecognized filesystem type **',
'## Executing script at 06d00000',
'Wrong image format for "source" command',
'scanning bus for devices...',
'',
'Device 0: unknown device',
'/',
'** Bad device scsi 0 **',
'## Executing script at 06d00000',
'Wrong image format for "source" command',
'/boot/',
'** Bad device scsi 0 **',
'## Executing script at 06d00000',
'Wrong image format for "source" command',
'/',
'Card did not respond to voltage select!',
'** Bad device mmc 1 **',
'## Executing script at 06d00000',
'Wrong image format for "source" command',
'/boot/',
'Card did not respond to voltage select!',
'** Bad device mmc 1 **',
'## Executing script at 06d00000',
'Wrong image format for "source" command',
'/',
'** File not found /boot.scr **',
'## Executing script at 06d00000',
'Wrong image format for "source" command',
'/boot/',
'1120 bytes read in 13 ms (84 KiB/s)',
'## Executing script at 06d00000',
'221 bytes read in 5 ms (43 KiB/s)',
'16421376 bytes read in 715 ms (21.9 MiB/s)',
'4403814 bytes read in 198 ms (21.2 MiB/s)',
'** File not found /boot/dtb/marvell/armada-3720-community.dtb **',
'8942 bytes read in 9 ms (969.7 KiB/s)',
'## Loading init Ramdisk from Legacy Image at 01100000 ...',
'   Image Name:   uInitrd',
'   Image Type:   AArch64 Linux RAMDisk Image (gzip compressed)',
'   Data Size:    4403750 Bytes = 4.2 MiB',
'   Load Address: 00000000',
'   Entry Point:  00000000',
'   Verifying Checksum ... OK',
'## Flattened Device Tree blob at 06000000',
'   Booting using the fdt blob at 0x6000000',
'   Loading Ramdisk to 3f1f7000, end 3f62a226 ... OK',
'   Using Device Tree in place at 0000000006000000, end 00000000060052ed',
'',
'Starting kernel ...',
'',
'[    0.000000] Booting Linux on physical CPU 0x0000000000 [0x410fd034]',
'[    0.000000] Linux version 4.19.20-mvebu64 (root@ubuntu) (gcc version 7.2.1 20171011 (Linaro GCC 7.2-2017.11)) #5.76 SMP PREEMPT Sat Mar 9 17:05:30 CET 2019',
'[    0.000000] Machine model: Globalscale Marvell ESPRESSOBin Board',
'[    0.000000] earlycon: ar3700_uart0 at MMIO 0x00000000d0012000 (options )',
'[    0.000000] bootconsole [ar3700_uart0] enabled',
'Loading, please wait...',
'starting version 232',
'Begin: Loading essential drivers ... done.',
'Begin: Running /scripts/init-premount ... done.',
'Begin: Mounting root file system ... Begin: Running /scripts/local-top ... done.',
'Begin: Running /scripts/local-premount ... Scanning for Btrfs filesystems',
'done.',
'Begin: Will now check root file system ... fsck from util-linux 2.29.2',
'fsck: error 2 (No such file or directory) while executing fsck.ext4 for /dev/mmcblk1p1',
'fsck exited with status code 8',
'done.',
'Warning: File system check failed but did not detect errors',
'done.',
'Begin: Running /scripts/local-bottom ... done.',
'Begin: Running /scripts/init-bottom ... done.',
'',
'Welcome to Debian GNU/Linux 9 (stretch)!',
'',
'<span class="terminal-window green">[  OK  ]</span> Started Forward Password Requests to Wall Directory Watch.',
'<span class="terminal-window green">[  OK  ]</span> Listening on /dev/initctl Compatibility Named Pipe.',
'<span class="terminal-window green">[  OK  ]</span> Created slice System Slice.',
'         Mounting POSIX Message Queue File System...',
'<span class="terminal-window green">[  OK  ]</span> Listening on udev Control Socket.',
'<span class="terminal-window green">[  OK  ]</span> Listening on Journal Socket (/dev/log).',
'<span class="terminal-window green">[  OK  ]</span> Listening on fsck to fsckd communication Socket.',
'<span class="terminal-window green">[  OK  ]</span> Created slice system-getty.slice.',
'<span class="terminal-window green">[  OK  ]</span> Started Dispatch Password Requests to Console Directory Watch.',
'<span class="terminal-window green">[  OK  ]</span> Reached target Paths.',
'<span class="terminal-window green">[  OK  ]</span> Listening on Network Service Netlink Socket.',
'         Mounting Debug File System...',
'<span class="terminal-window green">[  OK  ]</span> Reached target Remote File Systems.',
'<span class="terminal-window green">[  OK  ]</span> Reached target Swap.',
'<span class="terminal-window green">[  OK  ]</span> Reached target Encrypted Volumes.',
'<span class="terminal-window green">[  OK  ]</span> Listening on Journal Socket.',
'         Starting File System Check on Root Device...',
'         Starting Create list of required st?.|ce nodes for the current kernel...',
'         Starting Nameserver information manager...',
'<span class="terminal-window green">[  OK  ]</span> Listening on Journal Audit Socket.',
'         Starting Set the console keyboard layout...',
'<span class="terminal-window green">[  OK  ]</span> Listening on Syslog Socket.',
'         Starting Journal Service...',
'<span class="terminal-window green">[  OK  ]</span> Created slice system-serial\x2dgetty.slice.',
'         Mounting Huge Pages File System...',
'         Starting Restore / save the current clock...',
'<span class="terminal-window green">[  OK  ]</span> Created slice User and Session Slice.',
'<span class="terminal-window green">[  OK  ]</span> Reached target Slices.',
'<span class="terminal-window green">[  OK  ]</span> Listening on udev Kernel Socket.',
'         Starting Load Kernel Modules...',
'<span class="terminal-window green">[  OK  ]</span> Mounted POSIX Message Queue File System.',
'<span class="terminal-window green">[  OK  ]</span> Mounted Huge Pages File System.',
'<span class="terminal-window green">[  OK  ]</span> Mounted Debug File System.',
'<span class="terminal-window green">[  OK  ]</span> Started Create list of required sta?.|vice nodes for the current kernel.',
'<span class="terminal-window green">[  OK  ]</span> Started Restore / save the current clock.',
'<span class="terminal-window green">[  OK  ]</span> Started Load Kernel Modules.',
'<span class="terminal-window green">[  OK  ]</span> Started Nameserver information manager.',
'<span class="terminal-window green">[  OK  ]</span> Started Journal Service.',
'<span class="terminal-window green">[  OK  ]</span> Started File System Check Daemon to report status.',
'         Starting Apply Kernel Variables...te)',
'         Mounting Configuration File System...',
'         Starting Create Static Device Nodes in /dev...',
'<span class="terminal-window green">[  OK  ]</span> Mounted Configuration File System.te)',
'<span class="terminal-window green">[  OK  ]</span> Started Apply Kernel Variables.',
'<span class="terminal-window green">[  OK  ]</span> Started Create Static Device Nodes in /dev.',
'         Starting udev Kernel Device Manager...',
'<span class="terminal-window green">[  OK  ]</span> Started udev Kernel Device Manager.',
'         Starting Network Service...',
'<span class="terminal-window green">[  OK  ]</span> Started Network Service..2% complete)',
'<span class="terminal-window green">[  OK  ]</span> Started Set the console keyboard layout.',
'<span class="terminal-window green">[  OK  ]</span> Started File System Check on Root Device.',
'         Starting Remount Root and Kernel File Systems...',
'<span class="terminal-window green">[  OK  ]</span> Started Remount Root and Kernel File Systems.',
'         Starting Load/Save Random Seed...',
'         Starting Flush Journal to Persistent Storage...',
'         Starting udev Coldplug all Devices...',
'<span class="terminal-window green">[  OK  ]</span> Reached target Local File Systems (Pre).',
'         Mounting /tmp...',
'<span class="terminal-window green">[  OK  ]</span> Mounted /tmp.',
'<span class="terminal-window green">[  OK  ]</span> Started Load/Save Random Seed.',
'<span class="terminal-window green">[  OK  ]</span> Reached target Local File Systems.',
'         Starting Armbian ZRAM config...',
'         Starting Set console font and keymap...',
'         Starting Raise network interfaces...',
'<span class="terminal-window green">[  OK  ]</span> Started Flush Journal to Persistent Storage.',
'<span class="terminal-window green">[  OK  ]</span> Started Set console font and keymap.',
'         Starting Create Volatile Files and Directories...',
'<span class="terminal-window green">[  OK  ]</span> Started Create Volatile Files and Directories.',
'<span class="terminal-window green">[  OK  ]</span> Started Entropy daemon using the HAVEGE algorithm.',
'         Starting Update UTMP about System Boot/Shutdown...',
'<span class="terminal-window green">[  OK  ]</span> Reached target System Time Synchronized.',
'<span class="terminal-window green">[  OK  ]</span> Started Update UTMP about System Boot/Shutdown.',
'<span class="terminal-window green">[  OK  ]</span> Started udev Coldplug all Devices.',
'<span class="terminal-window green">[  OK  ]</span> Started Armbian ZRAM config.',
'<span class="terminal-window green">[  OK  ]</span> Started Raise network interfaces.',
'         Starting Armbian memory supported logging...',
'<span class="terminal-window green">[  OK  ]</span> Found device /dev/ttyMV0.',
'<span class="terminal-window green">[  OK  ]</span> Started Armbian memory supported logging.',
'<span class="terminal-window green">[  OK  ]</span> Reached target System Initialization.',
'         Starting Armbian hardware optimization...',
'<span class="terminal-window green">[  OK  ]</span> Started Daily apt download activities.',
'<span class="terminal-window green">[  OK  ]</span> Started Daily apt upgrade and clean activities.',
'<span class="terminal-window green">[  OK  ]</span> Started Daily Cleanup of Temporary Directories.',
'<span class="terminal-window green">[  OK  ]</span> Reached target Timers.',
'<span class="terminal-window green">[  OK  ]</span> Listening on D-Bus System Message Bus Socket.',
'<span class="terminal-window green">[  OK  ]</span> Reached target Sockets.',
'         Starting Armbian hardware monitoring...',
'<span class="terminal-window green">[  OK  ]</span> Started Armbian hardware optimization.',
'<span class="terminal-window green">[  OK  ]</span> Started Armbian hardware monitoring.',
'<span class="terminal-window green">[  OK  ]</span> Reached target Basic System.',
'<span class="terminal-window green">[  OK  ]</span> Started Regular background program processing daemon.',
'         Starting LSB: Load kernel modules needed to enable cpufreq scaling...',
'<span class="terminal-window green">[  OK  ]</span> Started D-Bus System Message Bus.',
'         Starting System Logging Service...',
'         Starting LSB: Start/stop sysstats sadc...',
'         Starting Login Service...',
'         Starting Network Manager...',
'<span class="terminal-window green">[  OK  ]</span> Started System Logging Service.',
'<span class="terminal-window green">[  OK  ]</span> Started LSB: Start/stop sysstats sadc.',
'<span class="terminal-window green">[  OK  ]</span> Started Login Service.',
'<span class="terminal-window green">[  OK  ]</span> Started LSB: Load kernel modules needed to enable cpufreq scaling.',
'         Starting LSB: set CPUFreq kernel parameters...',
'<span class="terminal-window green">[  OK  ]</span> Started LSB: set CPUFreq kernel parameters.',
'         Starting LSB: Set sysfs variables from /etc/sysfs.conf...',
'<span class="terminal-window green">[  OK  ]</span> Started Network Manager.',
'<span class="terminal-window green">[  OK  ]</span> Reached target Network.',
'         Starting OpenBSD Secure Shell server...',
'         Starting Permit User Sessions...',
'         Starting Network Name Resolution...',
'<span class="terminal-window green">[  OK  ]</span> Started Unattended Upgrades Shutdown.',
'         Starting Network Manager Wait Online...',
'<span class="terminal-window green">[  OK  ]</span> Started LSB: Set sysfs variables from /etc/sysfs.conf.',
'<span class="terminal-window green">[  OK  ]</span> Started Permit User Sessions.',
'         Starting Network Manager Script Dispatcher Service...',
'<span class="terminal-window green">[  OK  ]</span> Started Network Manager Script Dispatcher Service.',
'         Starting Hostname Service...',
'<span class="terminal-window green">[  OK  ]</span> Started OpenBSD Secure Shell server.',
'<span class="terminal-window green">[  OK  ]</span> Started Hostname Service.',
'<span class="terminal-window green">[  OK  ]</span> Started Network Name Resolution.',
'         Starting Authorization Manager...',
'<span class="terminal-window green">[  OK  ]</span> Started Network Manager Wait Online.',
'<span class="terminal-window green">[  OK  ]</span> Reached target Network is Online.',
'         Starting /etc/rc.local Compatibility...',
'         Starting LSB: Advanced IEEE 802.11 management daemon...',
'         Starting LSB: Start NTP daemon...',
'<span class="terminal-window green">[  OK  ]</span> Started /etc/rc.local Compatibility.',
'<span class="terminal-window green">[  OK  ]</span> Started LSB: Advanced IEEE 802.11 management daemon.',
'<span class="terminal-window green">[  OK  ]</span> Started Serial Getty on ttyMV0.',
'<span class="terminal-window green">[  OK  ]</span> Started Getty on tty1.',
'<span class="terminal-window green">[  OK  ]</span> Reached target Login Prompts.',
'<span class="terminal-window green">[  OK  ]</span> Started Authorization Manager.',
'<span class="terminal-window green">[  OK  ]</span> Started LSB: Start NTP daemon.',
'<span class="terminal-window green">[  OK  ]</span> Reached target Multi-User System.',
'<span class="terminal-window green">[  OK  ]</span> Reached target Graphical Interface.',
'         Starting Update UTMP about System Runlevel Changes...',
'<span class="terminal-window green">[  OK  ]</span> Started Update UTMP about System Runlevel Changes.',
           '',
           'Debian GNU/Linux 9 espressobin ttyMV0',
           '',
           'login: website',
           'Password: ',
           'Last login: ' + new Date(),
           '',
           "<em><b>𝐄𝐫𝐢𝐜'𝐬 𝐃𝐨𝐫𝐦 𝐑𝐨𝐨𝐦 𝐒𝐞𝐫𝐯𝐞𝐫</b></em>",
           '',
           'Welcome to ARMBIAN 5.76 user-built Debian GNU/Linux 9 (stretch) 4.19.20-mvebu64   ',
           'System load:   1.62 0.40 0.13   Up time:       1337 min',
           'Memory usage:  7 % of 990MB',
           'Usage of /:    10% of 15G    ',
           '',




           ];


function updateScrollBarPos(){
    var elem = $('.terminal-window section.terminal')[0]; //https://stackoverflow.com/questions/4069982/document-getelementbyid-vs-jquery
    elem.scrollTop = elem.scrollHeight;
}


if (shouldDoAnimation()) {
    for (var i = 0; i < text.length; i++) {
        doSetTimeout(i);

    }
} else {
    for (var i = 0; i < text.length; i++) {
        printToHistory(text[i]);
    }
}


//https://stackoverflow.com/questions/5226285/settimeout-in-for-loop-does-not-print-consecutive-values
function doSetTimeout(i) {
    setTimeout(function () {
        console.log("i: " + i);
       printToHistory(text[i]);
    }, 30 * i);
}

function getRndInteger(min, max) {
    return Math.floor(Math.random() * (max - min)) + min;
}


function shouldDoAnimation() {

    //UGG, this is why we need types!!!!
    if (getUrlParam('anim', true) == false || getUrlParam('anim', true) == "false" || getUrlParam('anim', true) == 0) {
        return false;
    }
    return true;
}

//https://html-online.com/articles/get-url-parameters-javascript/
function getUrlParam(parameter, defaultvalue) {
    var urlparameter = defaultvalue;
    if (window.location.href.indexOf(parameter) > -1) {
        urlparameter = getUrlVars()[parameter];
    }
    return urlparameter;
}

//https://html-online.com/articles/get-url-parameters-javascript/
function getUrlVars() {
    var vars = {};
    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
        vars[key] = value;
    });
    return vars;
}



function erase(n) {
    command = command.slice(0, -n);
    prompt.html(prompt.html().slice(0, -n));
}

function printToHistory(txt) {
    $(".history").append(txt + "<br>");
    updateScrollBarPos();
}

//typing in console
/*
    	//	Keypress doesn't catch special keys,
    	//	so we catch the backspace here and
    	//	prevent it from navigating to the previous
    	//	page. We also handle arrow keys for command history.
    	*/

var historyIndex = 0;
var commandHistory = [];

var terminal = $(".history");
var prompt = $(".prompt");

var command = "";



// COMMANDS
function cmd_clear() {
    terminal.text("");
}

function cmd_help() {
    printToHistory("There is no help :P");
}

function cmd_echo(args) {
    var str = args.join(" ");
    printToHistory(str);
}


var commands = [{
        "name": "clear",
        "function": cmd_clear
        },
    {
        "name": "help",
        "function": cmd_help
        },
    {
        "name": "echo",
        "function": cmd_echo
        }];

function appendCommand(str) {
    prompt.append(str);
    command += str;
}

//stap trying to break my site!
function strip(html){
   var doc = new DOMParser().parseFromString(html, 'text/html');
   return doc.body.textContent || "";
}

function processCommand() {
    var isValid = false;

    // Create args list by splitting the command
    // by space characters and then shift off the
    // actual command.
    
    command = strip(command); //try to remove bad things for people trying to break my site. Cough Cough CrackleHarvest36, I know you and your <script> tag shenanigans

    var args = command.split(" ");
    var cmd = args[0];
    args.shift();

    // Iterate through the available commands to find a match.
    // Then call that command and pass in any arguments.
    for (var i = 0; i < commands.length; i++) {
        if (cmd === commands[i].name) {
            printToHistory("website@ericsserver ~ $ " + command);
            commands[i].function(args);
            isValid = true;
            break;
        }
    }

    // No match was found...
    if (!isValid) {
        printToHistory("bash: lshw: command not found: '" + command + "'");
    }

    // Add to command history and clean up.
    commandHistory.push(command);
    historyIndex = commandHistory.length;
    command = "";
    prompt.html("website@ericsserver ~ $ ");
}

$(document).keydown(function (e) {
    e = e || window.event;
    var keyCode = typeof e.which === "number" ? e.which : e.keyCode;

    // BACKSPACE
    if (keyCode === 8 && e.target.tagName !== "INPUT" && e.target.tagName !== "TEXTAREA") {
        e.preventDefault();
        if (command !== "") {
            erase(1);
        }
    }

    // UP or DOWN
    if (keyCode === 38 || keyCode === 40) {
        // Move up or down the history
        if (keyCode === 38) {
            // UP
            historyIndex--;
            if (historyIndex < 0) {
                historyIndex++;
            }
        } else if (keyCode === 40) {
            // DOWN
            historyIndex++;
            if (historyIndex > commandHistory.length - 1) {
                historyIndex--;
            }
        }

        // Get command
        var cmd = commandHistory[historyIndex];
        if (cmd !== undefined) {
            clearCommand();
            appendCommand(cmd);
        }
    }
});

$(document).keypress(function (e) {
    // Make sure we get the right event
    e = e || window.event;
    var keyCode = typeof e.which === "number" ? e.which : e.keyCode;

    // Which key was pressed?
    switch (keyCode) {
        // ENTER
        case 13: {
            terminal.append("\n");

            processCommand();
            break;
        }
        default: {
            appendCommand(String.fromCharCode(keyCode));
        }
    }
});
